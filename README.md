# esp32\_press2pause‑blink <!-- omit in toc -->

<p align="center">
  <img src="https://img.shields.io/badge/ESP‑IDF-v5.4.x-blue?logo=espressif" />
  <img src="https://img.shields.io/badge/license-MIT-green" />
</p>

> **Press the button – the LED stops. Press again – it resumes.**
> Tiny FreeRTOS demo for ESP32‑Wrover‑CAM (or any ESP32) showcasing
> task suspend/resume, button debouncing, and power‑saving tricks.

---

* [Features](#features)
* [Hardware](#hardware)
* [Schematic / Wiring](#schematic--wiring)
* [Build & Flash](#build--flash)
* [Menuconfig tweaks](#menuconfig-tweaks)
* [Power‑saving variants](#power‑saving-variants)
* [Project tree](#project-tree)
* [License](#license)

---

## Features

* Blinks LED on **GPIO32** at **500 ms** intervals
* **Button (GPIO22)** toggles `vTaskSuspend` / `vTaskResume`
* C11 `atomic_bool` pause flag with software debouncing (200 ms)
* Compatible with **tickless light‑sleep** (≈ 1 mA idle current)
* Clean `CMakeLists.txt` for ESP‑IDF v5.4.x and VS Code IntelliSense

## Hardware

| Component                    | Connection                              |
| ---------------------------- | --------------------------------------- |
| LED + 220 Ω resistor         | GPIO32 → [220Ω] → LED → GND                      |
| Momentary push button        | GPIO22 → Button ↔ GND (pull‑up enabled) |
| ESP32-Wrover-CAM / ESP32-CAM | 5 V USB / 3V3 supply                    |

> **Power:** USB‑C 5 V or barrel jack (7–12 V) through onboard regulator.
> Li‑Po + boost converter or external 3.3 V supply recommended for power‑saving.

## Schematic / Wiring

```text
3V3 ─┐            
     │           
     └──• Button •┴── GPIO22

GPIO32 ── LED (anode) ──[resistor[220Ω]]── GND
```

*(Internal pull‑up enabled; button shorts GPIO22 to GND when pressed.)*

## Build & Flash

```bash
# 1. Open ESP‑IDF environment
. $HOME/esp/esp-idf/export.sh

# 2. Target & menuconfig (once)
idf.py set-target esp32
idf.py menuconfig   # optional tweaks

# 3. Build, flash, and monitor
idf.py build flash monitor  # auto-detects port or use -p COMx
```

Quit monitor with `Ctrl + ]`.

## Menuconfig tweaks

```
Component config → Power management
  [*] Enable power management
      Min CPU freq          40 MHz
      Max CPU freq          80 MHz
      [*] Light‑sleep when idle

Example Module Configuration
  Blink GPIO number         32   (or change as needed)
  Blink period in ms        500  
```

## Power‑saving variants

| Mode               | Change in code                          | Idle current |
| ------------------ | --------------------------------------- | ------------ |
| Default (tickless) | Use above menuconfig                    | \~1 mA       |
| Manual light‑sleep | Call `esp_light_sleep_start()` on pause | \~0.8 mA     |
| Deep‑sleep         | `esp_deep_sleep_start()` + ext0 wake    | <10 µA       |

## Project tree

```
esp32_press2pause‑blink/
├─ main/
│   └─ main.c         # app_main and blink logic
├─ CMakeLists.txt     # project build config
├─ sdkconfig          # generated by menuconfig
└─ README.md          # this file
```

## License

This project is licensed under the MIT License. See [LICENSE](LICENSE) for details.

Feel free to fork, remix, and flash away. Pull requests welcome!
